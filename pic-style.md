# **設計文件：底片風格模擬引擎 (Film Simulation Engine)**

版本: 1.0  
作者: Gemini

## **1\. 總覽**

本文件旨在設計一個模組化的影像處理引擎，用於模擬傳統底片的視覺風格。此引擎將讀取外部定義的 JSON 風格描述檔，並將其應用於數位影像上。引擎的核心目標是重現底片獨特的**色彩科學**、**顆粒感**、**光影過渡**以及**光學瑕疵**。

## **2\. 系統架構**

系統由兩個主要部分組成：**核心處理引擎 (Core Processing Engine)** 和 **風格設定檔 (Style Profiles)**。

\+----------------------+      \+---------------------------+  
|   輸入影像 (Input)   |-----\>|  核心處理引擎 (Engine)    |-----\>|   輸出影像 (Output)  |  
\+----------------------+      |                           |      \+----------------------+  
                             |  \+-----------------------+  |  
                             |  | 1\. 色彩與色調模組     |  |  
                             |  \+-----------------------+  |  
                             |  \+-----------------------+  |  
                             |  | 2\. 顆粒模擬模組       |  |  
                             |  \+-----------------------+  |  
                             |  \+-----------------------+  |  
                             |  | 3\. 光暈效果模組       |  |  
                             |  \+-----------------------+  |  
                             |  \+-----------------------+  |  
                             |  | 4\. 光學效果模組       |  |  
                             |  \+-----------------------+  |  
                             \+-------------^-------------+  
                                           | (讀取參數)  
                             \+-------------+-------------+  
                             |   風格設定檔 (JSON)       |  
                             \+---------------------------+

## **3\. 核心處理引擎模組**

引擎將按照以下順序，以管線 (Pipeline) 方式處理影像。每個模組都是可配置的，其行為由載入的 JSON 設定檔決定。

### **3.1 色彩與色調模組 (Color & Tone Module)**

此模組是風格的靈魂，負責重新詮釋影像的顏色和光影。

* **目的**: 模擬特定底片的色彩響應曲線和動態範圍。  
* **必要條件**:  
  1. **3D LUT (Look-Up Table) 應用器**:  
     * **實作**: 能夠讀取並應用 .cube 或 .3dl 格式的 3D LUT 檔案。這是實現精確色彩映射最關鍵的一步。你需要一個函式庫或自行實作算法，將影像的每個像素 RGB 值通過 LUT 轉換為新的 RGB 值。  
     * **參數**: lut\_3d (檔案路徑)。  
  2. **色調曲線 (Tone Curve) 調整**:  
     * **實作**: 提供對 RGB 主曲線以及 R, G, B 單獨通道曲線的調整能力。曲線可以用一組控制點 (例如：\[\[x1, y1\], \[x2, y2\]\]) 來定義，並使用樣條插值 (Spline Interpolation) 生成平滑曲線。這主要用來模擬底片柔和的高光衰減 (Highlight Roll-off)。  
     * **參數**: tone\_curve (包含 rgb, red, green, blue 的控制點陣列)。  
  3. **基礎色彩調整**:  
     * **實作**: 提供白平衡 (色溫 temperature、色調 tint)、鮮豔度 (vibrance) 和飽和度 (saturation) 的調整功能。這些通常在應用 LUT 之前或之後進行微調。  
     * **參數**: color 物件中的其餘參數。

### **3.2 顆粒模擬模組 (Film Grain Module)**

此模組負責添加自然的、物理感的底片顆粒。

* **目的**: 模擬鹵化銀晶體形成的隨機但有紋理的顆粒。  
* **必要條件**:  
  1. **雜訊生成器**:  
     * **實作**: 使用 **Perlin Noise** 或 **Simplex Noise** 演算法生成灰階雜訊圖。避免使用簡單的白噪訊，因為它看起來太規律、太「數位」。生成的雜訊應該是非均勻且有結構的。  
     * **參數**: roughness (控制雜訊的頻率或細節)。  
  2. **顆粒混合**:  
     * **實作**: 將生成的雜訊圖層以「覆蓋 (Overlay)」或「柔光 (Soft Light)」的混合模式疊加到原始影像上。  
     * **參數**: intensity (控制顆粒的可見度)。  
  3. **顆粒尺寸與色彩**:  
     * **實作**: 能夠控制雜訊圖的縮放比例來模擬不同大小的顆粒。同時，需要一個選項來決定顆粒是單色的 (灰階) 還是彩色的。  
     * **參數**: size, monochromatic。

### **3.3 光暈效果模組 (Halation Module)**

此模組模擬強光穿透底片片基反射所產生的紅色光暈。

* **目的**: 在高光邊緣添加柔和的紅色光暈，是電影感的重要特徵。  
* **必要條件**:  
  1. **高光提取**:  
     * **實作**: 建立一個僅包含影像高光部分的遮罩 (Mask)。可以通過設定一個亮度閾值 (Threshold) 來完成，例如，只保留亮度高於 90% 的像素。  
     * **參數**: threshold。  
  2. **模糊與著色**:  
     * **實作**: 對提取出的高光遮罩應用高斯模糊 (Gaussian Blur)。模糊的半徑決定了光暈的擴散範圍。然後將這個模糊後的圖層染上指定的顏色 (通常是紅色或橙色)。  
     * **參數**: radius, color\_rgb。  
  3. **效果混合**:  
     * **實作**: 將著色的光暈圖層以「濾色 (Screen)」或「線性減淡 (Linear Dodge)」的混合模式疊加回原始影像上。  
     * **參數**: intensity (控制光暈的強度)。

### **3.4 光學效果模組 (Optical Effects Module)**

此模組模擬鏡頭和底片邊緣可能出現的光學瑕疵。

* **目的**: 增加影像的真實感和復古感。  
* **必要條件**:  
  1. **暗角 (Vignette)**:  
     * **實作**: 生成一個從中心向邊緣逐漸變暗的徑向漸層，並將其以「正片疊底 (Multiply)」模式疊加到影像上。  
     * **參數**: intensity (暗角的深度), feather (暗角邊緣的羽化程度)。  
  2. **色差 (Chromatic Aberration) \- (可選進階功能)**:  
     * **實作**: 分離影像的 R, G, B 通道，對紅色和藍色通道進行微量的縮放或位移，然後再重新合併。這會在物體邊緣產生紫邊或綠邊。

## **4\. 風格設定檔 (JSON) 結構定義**

請參考本文件開頭提供的 film\_profiles.json 範例。該結構定義了引擎處理所需的所有參數，使其具有高度的可擴展性。未來若要新增風格，只需添加新的 JSON 物件即可，無需修改引擎程式碼。

## **5\. 實作建議**

* **程式語言與函式庫**:  
  * **Python**: 使用 OpenCV 和 NumPy 進行影像處理，Pillow 進行影像讀寫。scikit-image 也提供了許多有用的濾鏡和演算法。  
  * **JavaScript (Web)**: 使用 Canvas API 進行像素操作，或利用 WebGL 進行 GPU 加速以獲得更好的性能。gl-react 或 Three.js 等函式庫可以簡化 WebGL 的操作。  
  * **C++**: 追求極致性能的最佳選擇，可整合 OpenCV 或自行編寫影像處理算法。  
* **開發流程**:  
  1. 從**色彩與色調模組**開始，這是最影響風格的部分。先實現 LUT 和色調曲線功能。  
  2. 接著實作**顆粒模擬模組**，注意讓顆粒看起來自然。  
  3. 最後再加入**光暈**和**暗角**等點綴性的效果。  
  4. 編寫一個主程式，能夠載入 JSON 檔案，解析參數，並依序調用各個模組。